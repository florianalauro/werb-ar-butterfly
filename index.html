const swarm = document.querySelector('#swarm');
const numButterflies = 20; // Aumentiamo un po' il numero per l'effetto tunnel

for (let i = 0; i < numButterflies; i++) {
    let butterfly = document.createElement('a-entity');
    
    butterfly.setAttribute('gltf-model', '#butterflyModel');
    butterfly.setAttribute('animation-mixer', 'clip: Flying');
    butterfly.setAttribute('scale', '0.04 0.04 0.04');

    // Funzione per resettare la farfalla a destra
    const resetButterfly = (el) => {
        const startX = 5; // Inizia a 5 metri a destra
        const randomY = Math.random() * 2 + 1; // Altezza casuale
        const randomZ = (Math.random() - 0.5) * 4; // Profondità casuale per l'effetto tunnel
        
        el.setAttribute('position', `${startX} ${randomY} ${randomZ}`);
        el.setAttribute('rotation', '0 -90 0'); // Ruotata per guardare a sinistra

        // Animazione verso sinistra
        el.setAttribute('animation', {
            property: 'position',
            to: `-5 ${randomY} ${randomZ}`, // Arriva a 5 metri a sinistra
            dur: Math.random() * 5000 + 5000, // Velocità variabile tra 5 e 10 secondi
            easing: 'linear',
            loop: false // Gestiamo il loop manualmente al termine
        });
    };

    // Ascolta quando l'animazione finisce per resettare la farfalla
    butterfly.addEventListener('animationcomplete', () => {
        resetButterfly(butterfly);
    });

    // Avvio iniziale con un ritardo casuale per non farle partire tutte insieme
    setTimeout(() => {
        swarm.appendChild(butterfly);
        resetButterfly(butterfly);
    }, Math.random() * 5000);
}
