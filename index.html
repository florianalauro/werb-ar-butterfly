<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sciame di Farfalle AR</title>
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    
    <a-scene renderer="colorManagement: true;" xr-mode-ui="enabled: true" webxr="optionalFeatures: hit-test;">
      
      <a-assets>
        <a-asset-item id="butterflyModel" src="animated_butterfly.glb"></a-asset-item>
      </a-assets>

      <a-entity id="swarm"></a-entity>

      <a-entity camera look-controls wasd-controls></a-entity>
    </a-scene>

    <script>
      // Script per generare 15 farfalle in posizioni casuali
      const swarm = document.querySelector('#swarm');
      const numButterflies = 15;

      for (let i = 0; i < numButterflies; i++) {
        let butterfly = document.createElement('a-entity');
        
        // Impostiamo il modello e l'animazione "Flying" che c'è nel tuo file
        butterfly.setAttribute('gltf-model', '#butterflyModel');
        butterfly.setAttribute('animation-mixer', 'clip: Flying');
        
        // Rendiamole piccole (0.05 è il 5% della dimensione originale)
        butterfly.setAttribute('scale', '0.05 0.05 0.05');

        // Posizione casuale intorno all'utente (entro 3 metri)
        let x = (Math.random() - 0.5) * 6;
        let y = Math.random() * 3 + 1; // Altezza tra 1 e 4 metri
        let z = (Math.random() - 0.5) * 6;
        butterfly.setAttribute('position', `${x} ${y} ${z}`);

        // Animazione di movimento (le farfalle si muovono lentamente su e giù)
        butterfly.setAttribute('animation', {
          property: 'position',
          to: `${x} ${y + 0.5} ${z + 0.5}`,
          dur: Math.random() * 3000 + 2000,
          dir: 'alternate',
          loop: true,
          easing: 'easeInOutSine'
        });

        // Rotazione casuale iniziale
        butterfly.setAttribute('rotation', `0 ${Math.random() * 360} 0`);

        swarm.appendChild(butterfly);
      }
    </script>
  </body>
</html>
